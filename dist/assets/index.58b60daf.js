import*as n from"https://unpkg.com/three@0.126.1/build/three.module.js";import{TrackballControls as W}from"https://unpkg.com/three@0.126.1/examples/jsm/controls/TrackballControls.js";import{RGBELoader as F}from"https://unpkg.com/three@0.126.1/examples/jsm/loaders/RGBELoader.js";import{OBJLoader as H}from"https://unpkg.com/three@0.126.1/examples/jsm/loaders/OBJLoader.js";import*as N from"https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function a(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?r.credentials="include":e.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(e){if(e.ep)return;e.ep=!0;const r=a(e);fetch(e.href,r)}})();let b,L,p,w,i;const d=8;let x=[];const l=new n.Group,s={shadows:{shadowsEnable:!1},lights:{spotLightTargetX:4,spotLightTargetY:10,spotLightTargetZ:4,spotLightIntensity:3,spotLightAngle:Math.PI/12},scene:{rotationEnable:!1},renderer:{exposure:.1}};_();K();function _(){const t=new N.GUI;t.add(s.shadows,"shadowsEnable").name("Enable shadows").onChange(()=>{p.traverse(function(e){e.castShadow=s.shadows.shadowsEnable})}),t.add(s.lights,"spotLightTargetX",-d/2,d/2,.1).onChange(e=>{s.lights.spotLightTargetX=e,V()}),t.add(s.lights,"spotLightTargetY",-d/2,d/2,.1).onChange(e=>{s.lights.spotLightTargetY=e,V()}),t.add(s.lights,"spotLightTargetZ",-d/2,d/2,.1).onChange(e=>{s.lights.spotLightTargetZ=e,V()}),t.add(s.lights,"spotLightIntensity",.5,20,.1).onChange(e=>{s.lights.spotLightIntensity=e,V()}),t.add(s.scene,"rotationEnable").name("Enable rotation").onChange(()=>{console.log(s.scene)}),p=new n.Scene;const h=new n.CylinderGeometry(d*.35,d*.35,d*10,24),a=new n.MeshPhongMaterial({color:0}),o=new n.Mesh(h,a);o.translateY(-d*5.04),p.add(o),b=new n.PerspectiveCamera(75,innerWidth/innerHeight,.1,1e3),b.position.z=5,w=new n.WebGLRenderer({antialias:!0}),w.setPixelRatio(window.devicePixelRatio),w.setSize(window.innerWidth,window.innerHeight),w.shadowMap.enabled=!0,w.shadowMap.type=n.PCFSoftShadowMap,document.body.appendChild(w.domElement),w.toneMapping=n.ReinhardToneMapping,w.toneMappingExposure=s.renderer.exposure,w.outputEncoding=n.sRGBEncoding,new F().load("./old_hall_2k.hdr",function(e){e.mapping=n.EquirectangularReflectionMapping,p.background=e,p.environment=e}),L=new W(b,w.domElement),L.rotateSpeed=1,L.zoomSpeed=1.2,L.panSpeed=.8,L.keys=["KeyA","KeyS","KeyD"],V(),J(d),D(d),console.log(l),p.add(l)}function K(){requestAnimationFrame(K),s.scene.rotationEnable==!0&&l.rotateOnWorldAxis(new n.Vector3(0,1,0),.003),L.update(),w.render(p,b)}function D(t){const h=t/8,a=t/16;for(let o=0;o<8;o++)O(t/26,16777215,-t/2+o*h+a,h*2+a);for(let o=0;o<8;o++)O(t/26,0,-t/2+o*h+a,-h*3+a);S(t*.05,16777215,-h+a,h*3+a),S(t*.05,0,0+a,-h*4+a),E(t/23,0,-t/2+a,-t/2+a),E(t/23,0,t/2-a,-t/2+a),E(t/23,16777215,-t/2+a,t/2-a),E(t/23,16777215,t/2-a,t/2-a)}function O(t,h,a,o){const e=new n.MeshPhysicalMaterial({color:h,metalness:0,roughness:.5,clearcoat:0,clearcoatRoughness:.3,reflectivity:.5,transmission:.9}),r=new n.BoxGeometry(t*1.7,t*.1,t*1.7);r.translate(a,0,o);const c=new n.BoxGeometry(t*1.3,t*.8,t*1.3);c.translate(a,t*.4,o);const f=new n.BoxGeometry(t*1.4,t*.1,t*1.4);f.translate(a,t*.8,o);const m=new n.BoxGeometry(t*1,t*.7,t*1);m.translate(a,t*1.2,o);const y=new n.BoxGeometry(t*1.1,t*.1,t*1.1);y.translate(a,t*1.6,o);const M=new n.BoxGeometry(t*.6,t*1.1,t*.6);M.translate(a,t*2.2,o);const g=new n.BoxGeometry(t*.7,t*.1,t*.7);g.translate(a,t*2.7,o);const u=new n.BoxGeometry(t*.2,t*.4,t*.2);u.translate(a,t*2.9,o);const G=new n.BoxGeometry(t*.9,t*.8,t*.9);G.translate(a,t*3.2,o);const B=new n.Mesh(r,e);B.castShadow=s.shadows.shadowsEnable;const T=new n.Mesh(c,e);T.castShadow=s.shadows.shadowsEnable;const P=new n.Mesh(f,e);P.castShadow=s.shadows.shadowsEnable;const R=new n.Mesh(m,e);R.castShadow=s.shadows.shadowsEnable;const C=new n.Mesh(y,e);C.castShadow=s.shadows.shadowsEnable;const k=new n.Mesh(M,e);k.castShadow=s.shadows.shadowsEnable;const A=new n.Mesh(g,e);A.castShadow=s.shadows.shadowsEnable;const I=new n.Mesh(u,e);I.castShadow=s.shadows.shadowsEnable;const q=new n.Mesh(G,e);q.castShadow=s.shadows.shadowsEnable,l.add(B),l.add(T),l.add(P),l.add(R),l.add(C),l.add(k),l.add(A),l.add(I),l.add(q)}function S(t,h,a,o){const e=[];e.push(new n.Vector2(0,0)),e.push(new n.Vector2(1,0)),e.push(new n.Vector2(1.05,.072)),e.push(new n.Vector2(.946,.159)),e.push(new n.Vector2(.997,.204)),e.push(new n.Vector2(.885,.296)),e.push(new n.Vector2(1,.468)),e.push(new n.Vector2(.93,.6)),e.push(new n.Vector2(.67,.71)),e.push(new n.Vector2(.78,.79)),e.push(new n.Vector2(.688,.872)),e.push(new n.Vector2(.638,.852)),e.push(new n.Vector2(.43,1.43)),e.push(new n.Vector2(.34,2.12)),e.push(new n.Vector2(.334,2.67)),e.push(new n.Vector2(.54,2.67)),e.push(new n.Vector2(.643,2.81)),e.push(new n.Vector2(.496,2.9)),e.push(new n.Vector2(.5,2.96)),e.push(new n.Vector2(.41,3)),e.push(new n.Vector2(.445,3.06)),e.push(new n.Vector2(.324,3.12)),e.push(new n.Vector2(.4,3.36)),e.push(new n.Vector2(.55,3.63)),e.push(new n.Vector2(.612,3.79)),e.push(new n.Vector2(.506,3.78)),e.push(new n.Vector2(.273,3.88)),e.push(new n.Vector2(.208,3.93)),e.push(new n.Vector2(.263,4)),e.push(new n.Vector2(.172,4.08)),e.push(new n.Vector2(0,4.085));const r=new n.LatheGeometry(e,24),c=new n.MeshPhysicalMaterial({color:h,metalness:.3,roughness:.8,clearcoat:1,clearcoatRoughness:.1,reflectivity:.7,transmission:0}),f=new n.BoxGeometry(.2,.7,.1),m=new n.BoxGeometry(.5,.2,.1);f.translate(0,4.3,0),m.translate(0,4.3,0),f.scale(t,t,t),m.scale(t,t,t);const y=new n.Mesh(f,c),M=new n.Mesh(m,c);y.translateX(a),y.translateZ(o),M.translateX(a),M.translateZ(o);const g=new n.Mesh(r,c);g.scale.set(t,t,t),g.translateX(a),g.translateZ(o);const u=new n.Group;u.add(y),u.add(M),u.add(g),l.add(u)}function E(t,h,a,o){const e=new H,r=new n.MeshPhysicalMaterial({color:h,metalness:.3,roughness:.8,clearcoat:1,clearcoatRoughness:.1,reflectivity:.7,transmission:0});e.load("rook.obj",function(c){c.children[0].material=r,c.children[0].translateX(a),c.children[0].translateZ(o),c.children[0].geometry.scale(t,t,t),l.add(c.children[0])})}function J(t){const h=new n.MeshPhysicalMaterial({color:16777215,metalness:0,roughness:.9,clearcoat:.7,clearcoatRoughness:.8,reflectivity:.15,transmission:0}),a=new n.MeshPhysicalMaterial({color:2955786,metalness:0,roughness:.9,clearcoat:.7,clearcoatRoughness:.8,reflectivity:.15,transmission:0}),o=t/8;for(let e=0;e<8;e++)for(let r=0;r<8;r++)(e+r)%2==0?Y(o,o*e-t/2+o/2,-t*.02,o*r-t/2+o/2,h):Y(o,o*e-t/2+o/2,-t*.02,o*r-t/2+o/2,a)}function Y(t,h,a,o,e){const r=new n.BoxGeometry(t,t*.3,t);r.translate(h,a,o);const c=new n.Mesh(r,e);c.receiveShadow=!0,l.add(c)}function V(){x.forEach(function(h){p.remove(h)}),x=[],i=new n.SpotLight(5592405,s.lights.spotLightIntensity),i.castShadow=!0,i.angle=s.lights.spotLightAngle,i.penumbra=1,i.decay=2,i.distance=50,i.position.set(-d/2,d/4,-d/2),p.add(i),p.add(i.target),i.target.position.set(s.lights.spotLightTargetX,s.lights.spotLightTargetY,s.lights.spotLightTargetZ),x.push(i);const t=new n.AmbientLight(2105376);p.add(t),x.push(t)}
